<div class="content">
    <div class="span4">
        <h2 class="geek">Friends</h2>
        
    </div>
    
    <div class="btn-group pull-right">
        
        <a ng-class="prevClass" ng-click="prev()">Prev</a>
        <a ng-class="nextClass" ng-click="next()">Next</a>

        <a href="#add-friend-form" id="add-friend-btn" class="btn"><i id="add-friend" title="Add a new friend" class="icon icon-plus"></i></a>
        <delete-friend warning="#delete-all-warning"></delete-friend>
        <a id="import-drop" href="#" class=" btn dropdown-toggle" data-toggle="dropdown">Import <b class="caret"></b></a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="import-drop">
            <li role="presentation">
                <a role="menuItem" tabindex="-1" href="/geeks/#/import">Import from Google</a>
            </li>
        </ul>
    </div>
    
    <input style="margin-left:10px;margin-right: 10px" class="pull-right" type="text" ng-change="search()" placeholder="Search" ng-model="searchArgs.friendSearch" />
        
    <div class="pull-right">
        <text>Unrated Friends : </text>
        <input type="checkbox" ng-change="search()" ng-model="searchArgs.unratedFriends" />
    </div>
    
    <div ng-show="friends.length > 0">
        
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th width="40px"></th>
                    <th width="40px"></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="friend in friends">
                    <td>{{friend.Name}}</td>
                    <td>{{friend.Email}}</td>
                    <td>
                        <button title="Rate your friend" role="button" class="rank-friend btn" data-userId="{{friend.UserId}}"><span ng-class="ratingClass">{{friend.Rating}}</span></button>
                    </td>
                    <td>
                        <delete-friend warning="#delete-warning"></delete-friend>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div id="delete-warning" class="modal hide fade">
            <div class="modal-header">
                <h3 class="geek">Delete Friend</h3>
            </div>
            <div class="modal-body">
                <p>
                    Are you sure you want to delete this friend? You will not be able to invite them to events any more if you do.
                </p>
            </div>
            <div class="modal-footer">
                <button accesskey="N" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">No</button>
                <input accesskey="Y" id="delete-friend" type="button" class="btn" value="Yes" ng-click="deleteFriend()" /> 
            </div>
        </div>
        
        <div id="delete-all-warning" class="modal hide fade">
            <div class="modal-header">
                <h3 class="geek">Delete All Friends</h3>
            </div>
            <div class="modal-body">
                <p>
                    Are you sure you want to delete all of your friends? You will not be able to invite them to events and you will lose all your ratings.
                </p>
            </div>
            <div class="modal-footer">
                <button accesskey="N" class="btn btn-danger" data-dismiss="modal" aria-hidden="true">No</button>
                <button accesskey="Y" class="btn" ng-click="deleteAllFriends()">Yes</button>
            </div>
        </div>
        
        <div id="add-friend-form" class="modal hide fade">
            <div class="modal-header">
                <h3 class="geek">Add a new friend</h3>
            </div>
            <div class="modal-body">
                <input type="text" id="friend-name" placeholder="Friend's Name" value=""/>
                <input type="text" id="friend-email" placeholder="Friend's Email Address" value=""/>
            </div>
            <div class="modal-footer">
                <button accesskey="A" id="add-friend-submit" class="btn btn-primary">Add</button>
                <button accesskey="C" class="btn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>

</div>

@section scripts{
    <script src="../js/ranking.js" type="text/javascript"></script>
    <script type="text/javascript">
        $("#nav-bar li.active").removeClass("active");
        $("#friends-nav").addClass("active");
        
        $(function() {

            enablePopovers('@Url.Action("RateFriend", "Home")', "button", "span");

            $("#add-friend-btn").click(function(e) {
                e.preventDefault();
                $("#friend-name").val('').removeClass("input-validation-error").focus();
                $("#friend-email").removeClass("input-validation-error").val('');
                $("#add-friend-form").modal();
            });

            $("#add-friend,#delete-all").tooltip({
                animation: true,
                placement: 'top'
            });

            $("a.delete-all-friends").click(function(e) {
                e.preventDefault();
                $("#delete-all-warning").modal();
            });

            $("#add-friend-submit").click(function(e) {
                e.preventDefault();
                var name = $("#friend-name").removeClass("input-validation-error").val();
                var email = $("#friend-email").removeClass("input-validation-error").val();
                var valid = true;
                if (name.length === 0) {
                    $("#friend-name").addClass("input-validation-error").attr("title", "Enter your friend's name");
                    valid = false;
                }
                if (email.length === 0) {
                    $("#friend-email").addClass("input-validation-error").attr("title", "Enter your friend's email");
                    valid = false;
                }
                if (!valid)
                    return;
                $.post("AddFriend", {
                        __RequestVerificationToken: $("input[name='__RequestVerificationToken']").val(),
                        name: name,
                        email: email, 
                    }, function(data) {
                        $("#table-placeholder").empty()[0].innerHTML = data;
                        setupDeleteLinks();
                        $('#add-friend-form').modal('hide');
                    });
            });

            $("#delete-all-confirm").click(function(e) {
                e.preventDefault();
                $.post("DeleteAllFriends", {
                        __RequestVerificationToken: $("input[name='__RequestVerificationToken']").val()
                    }, function(data) {
                        $("#table-placeholder").empty()[0].innerHTML = data;
                        setupDeleteLinks();
                        $('#delete-all-warning').modal('hide');
                    });
            });
        });
    </script>
}