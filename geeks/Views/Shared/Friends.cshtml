@model IEnumerable<geeks.Models.UserFriend>
@{
    ViewBag.Title = "Friends";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content">
    <h2 class="geek pull-left">Friends</h2>
    
    <div class="dropdown pull-right">
        <a id="import-drop" href="#" role="button" class="dropdown-toggle btn" data-toggle="dropdown">Import <b class="caret"></b></a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="import-drop">
            <li role="presentation">
                @Html.ActionLink("Import from google", "OAuth", "Import", routeValues: null, htmlAttributes: new { @role = "menuitem", @tabindex = "-1" })
            </li>
            <li role="presentation">
                @Html.ActionLink("Import from twitter", "ImportTwitter", "Import", routeValues: null, htmlAttributes: new { @role = "menuitem", @tabindex = "-1" })
            </li>
        </ul>

    </div>
    
    @if (Model.Any())
    {
        <div id="table-placeholder">
            @Html.Partial("FriendsTable")
        </div>
        
        <div id="delete-warning" class="modal hide fade">
            <div class="modal-header">
                <h3 class="geek">Delete Friend</h3>
            </div>
            <div class="modal-body">
                <p>
                    Are you sure you want to delete this friend? You will not be able to invite them to events any more if you do.
                </p>
            </div>
            <div class="modal-footer">
                <button accesskey="N" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">No</button>
                <input accesskey="Y" id="delete-friend" type="button" class="btn" value="Yes"/>
            </div>
        </div>
        
        @Html.AntiForgeryToken()
    }
</div>

@section scripts{
    <script type="text/javascript">
        $(function() {
            var selected = null;
            $("#nav-bar li.active").removeClass("active");
            $("#friends-nav").addClass("active");

            function setupDeleteLinks() {
                $("a.delete-friend").tooltip({
                    animation: true,
                    title: 'Delete this friend',
                    trigger: 'hover',
                    placement: 'right'
                }).click(function(e) {
                    e.preventDefault();
                    selected = $(this).attr('data-friend-email');
                    $("#delete-warning").modal();
                });
                $("#delete-friend").unbind("click").click(function(e) {
                    e.preventDefault();
                    $.post("DeleteFriend/" + selected, {
                            __RequestVerificationToken: $("input[name='__RequestVerificationToken']").val()
                        }, function(data) {
                            $("#table-placeholder").empty();
                            $(data).appendTo("#table-placeholder");
                            setupDeleteLinks();
                            $('#delete-warning').modal('hide');
                        });
                });
            }

            setupDeleteLinks();
        });
    </script>
}